<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Heavy Duty Productions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0; background:#111; color:#eee; }
    header { padding:1rem; text-align:center; background:#000; }
    header img { height:60px; }
    nav { display:flex; justify-content:center; gap:2rem; background:#222; padding:0.5rem; position:sticky; top:0; z-index:10; }
    nav a { color:#eee; text-decoration:none; font-weight:600; }
    nav a[aria-current="page"] { color:#00e5ff; }
    main { padding:1rem; }
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1rem; }
    .grid img { width:100%; height:auto; cursor:pointer; border-radius:8px; }
    .modal { position:fixed; inset:0; background:rgba(0,0,0,0.92); display:none; align-items:center; justify-content:center; }
    .modal img { max-width:90vw; max-height:85vh; border-radius:8px; }
    .modal.show { display:flex; }
    .close { position:absolute; top:1rem; right:2rem; font-size:2rem; color:#fff; cursor:pointer; }
    .empty { opacity:0.85; text-align:center; padding:2rem; }
  </style>
</head>
<body>
  <header>
    <img src="heavy-duty.png" alt="Heavy Duty Productions Logo" id="brandLogo">
    <h1>Heavy Duty Productions</h1>
  </header>

  <nav aria-label="Sections">
    <a class="tab" data-route="/" href="#/">Home</a>
    <a class="tab" data-route="/hoodies" href="#/hoodies">Hoodies</a>
    <a class="tab" data-route="/tshirts" href="#/tshirts">T-Shirts</a>
    <a class="tab" data-route="/production-images" href="#/production-images">Production Images</a>
  </nav>

  <main>
    <!-- Home (static placeholder) -->
    <section id="home" data-view="home">
      <h2>Welcome to Heavy Duty Productions</h2>
      <p>Choose a category above to browse images.</p>
    </section>

    <!-- Image grid -->
    <section id="grid" hidden>
      <div class="grid" id="imageGrid"></div>
      <div class="empty" id="emptyMsg" hidden>No images found in this folder. Ensure files are named IMG_0001â€¦IMG_9999 (jpg/jpeg/png/webp).</div>
    </section>
  </main>

  <!-- Modal viewer -->
  <div class="modal" id="modal">
    <span class="close" id="closeBtn">&times;</span>
    <img id="modalImg" src="" alt="">
  </div>

  <script>
    const grid = document.getElementById("grid");
    const imageGrid = document.getElementById("imageGrid");
    const emptyMsg = document.getElementById("emptyMsg");
    const home = document.getElementById("home");
    const modal = document.getElementById("modal");
    const modalImg = document.getElementById("modalImg");
    const closeBtn = document.getElementById("closeBtn");

    const CATEGORIES = {
      hoodies: "Hoodies/",
      tshirts: "T-Shirts/",
      "production-images": "Production Images/"
    };
    const EXTS = [".jpg",".jpeg",".png",".webp",".JPG",".JPEG",".PNG",".WEBP"];
    const START = 1, END = 9999;

    function clearGrid() { imageGrid.innerHTML = ""; emptyMsg.hidden = true; }
    function showModal(src) { modalImg.src = src; modal.classList.add("show"); }
    function closeModal() { modal.classList.remove("show"); modalImg.src = ""; }
    closeBtn.onclick = closeModal;
    modal.onclick = e => { if(e.target===modal) closeModal(); };
    window.addEventListener("keydown", e => { if(e.key === "Escape") closeModal(); });

    function encPath(path) {
      return path.split("/").filter(Boolean).map(encodeURIComponent).join("/") + (path.endsWith("/")?"/":"");
    }

    function getGhContext(){
      const host = location.hostname;
      if(!/github\.io$/i.test(host)) return null;
      const owner = host.split('.')[0];
      const parts = location.pathname.split('/').filter(Boolean);
      const repo = parts[0] || '';
      return { owner, repo };
    }

    async function tryListFolder(cat){
      const folder = CATEGORIES[cat];
      if(!folder) return false;
      const ctx = getGhContext();
      if(!ctx) return false;
      const clean = folder.replace(/\/$/, '');
      const encodedPath = clean.split('/').map(encodeURIComponent).join('/');
      const api = `https://api.github.com/repos/${ctx.owner}/${ctx.repo}/contents/${encodedPath}`;
      try{
        const res = await fetch(api, { headers:{ 'Accept':'application/vnd.github.v3+json' }});
        if(!res.ok) return false;
        const items = await res.json();
        if(!Array.isArray(items)) return false;
        const files = items
          .filter(x => x.type==='file' && /^IMG_\d{4}\.(jpg|jpeg|png|webp)$/i.test(x.name))
          .sort((a,b)=> a.name.localeCompare(b.name));
        if(files.length===0) return false;
        for(const f of files){
          // Prefer relative repo path to avoid any cross-origin surprises
          const rel = `${folder}${f.name}`;
          const el = document.createElement('img');
          el.src = rel;
          el.alt = f.name;
          el.onclick = ()=> showModal(el.src);
          imageGrid.appendChild(el);
        }
        return true;
      }catch(e){ return false; }
    }

    function preload(src) {
      return new Promise(resolve => {
        const img = new Image();
        img.onload = () => resolve(true);
        img.onerror = () => resolve(false);
        img.src = src;
      });
    }

    async function firstExistingForIndex(folder, i) {
      const num = String(i).padStart(4,"0");
      for (const ext of EXTS) {
        const src = `${folder}IMG_${num}${ext}`;
        if (await preload(src)) return src;
      }
      return null;
    }

    async function seedIndices(folder) {
      const seeds = [];
      for (let i = START; i <= END; i += 50) {
        const hit = await firstExistingForIndex(folder, i);
        if (hit) { seeds.push(i); if (seeds.length >= 6) break; }
      }
      if (seeds.length === 0) {
        for (let i = START; i <= END; i += 10) {
          const hit = await firstExistingForIndex(folder, i);
          if (hit) { seeds.push(i); if (seeds.length >= 3) break; }
        }
      }
      return seeds;
    }

    async function expandAround(folder, center, radius=120) {
      const start = Math.max(START, center - radius);
      const stop  = Math.min(END,   center + radius);
      let count = 0;
      for (let i = start; i <= stop; i++) {
        const num = String(i).padStart(4,"0");
        for (const ext of EXTS) {
          const src = `${folder}IMG_${num}${ext}`;
          const ok = await preload(src);
          if (ok) {
            const el = document.createElement("img");
            el.src = src;
            el.alt = `IMG_${num}`;
            el.onclick = () => showModal(src);
            imageGrid.appendChild(el);
            count++;
            break;
          }
        }
      }
      return count;
    }

    async function loadCategory(cat) {
      clearGrid();
      if (!cat) {
        home.hidden = false;
        grid.hidden = true;
        return;
      }
      home.hidden = true;
      grid.hidden = false;

      const folderRaw = CATEGORIES[cat];
      if (!folderRaw) { emptyMsg.hidden = false; return; }
      const folder = encPath(folderRaw);

      // 1) GitHub API listing (project pages)
      if (await tryListFolder(cat)) return;

      // 2) Seeded probing
      const seeds = await seedIndices(folder);
      if (seeds.length === 0) { emptyMsg.hidden = false; return; }
      let total = 0;
      for (const s of seeds) total += await expandAround(folder, s, 120);
      if (total === 0) emptyMsg.hidden = false;
    }

    function route() {
      const hash = location.hash.replace(/^#/,"") || "/";
      document.querySelectorAll(".tab").forEach(a=>a.removeAttribute("aria-current"));
      const active = document.querySelector(`.tab[href="#${hash}"]`);
      if(active) active.setAttribute("aria-current","page");

      if (hash === "/" || hash === "") loadCategory(null);
      else if (hash.startsWith("/hoodies")) loadCategory("hoodies");
      else if (hash.startsWith("/tshirts") || hash.startsWith("/t-shirts")) loadCategory("tshirts");
      else if (hash.startsWith("/production-images")) loadCategory("production-images");
      else loadCategory(null);
    }

    window.addEventListener("hashchange", route);
    window.addEventListener("load", route);
  </script>
</body>
</html>
