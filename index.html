<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Heavy Duty Productions</title>
  <style>
    :root { color-scheme: dark; }
    /* --- OVESRPRAY FONT (multiple fallbacks/paths) --- */
    @font-face {
      font-family: 'Overspray';
      src:
        url('Overspray.woff2') format('woff2'),
        url('Overspray-PAWZ.ttf') format('truetype'),
        url('fonts/Overspray.woff2') format('woff2'),
        url('fonts/Overspray-PAWZ.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0; background:#111; color:#eee; }
    header { padding:1rem; text-align:center; background:#000; }
    header img { height:60px; }
    header h1 { font-family: 'Overspray', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0.5rem 0 0; letter-spacing: .5px; }

    /* Tabs */
    nav { display:flex; justify-content:center; gap:1rem; background:#222; padding:0.5rem; position:sticky; top:0; z-index:10; }
    nav a { 
      color:#eee; text-decoration:none; font-size:0.95rem; letter-spacing:.3px; white-space:nowrap;
      font-family: 'Overspray', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; text-rendering: optimizeLegibility;
      padding:.35rem .6rem; border-radius:8px;
    }
    nav a[aria-current="page"] { color:#00e5ff; background:#1a1a1a; }

    main { padding:1rem; }
    h2, h3, p { font-family: 'Overspray', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; letter-spacing:.4px; }

    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1rem; }
    .card { aspect-ratio: 1/1; background:#1b1b1b; border-radius:8px; display:flex; align-items:center; justify-content:center; overflow:hidden; position:relative; }
    .card .ph { width:40%; height:40%; border-radius:6px; background:#2a2a2a; animation:pulse 1.2s infinite ease-in-out; }
    @keyframes pulse { 0%{opacity:0.6} 50%{opacity:1} 100%{opacity:0.6} }
    .grid img { width:100%; height:100%; object-fit:cover; cursor:pointer; display:block; }
    .modal { position:fixed; inset:0; background:rgba(0,0,0,0.92); display:none; align-items:center; justify-content:center; }
    .modal img { max-width:90vw; max-height:85vh; border-radius:8px; }
    .modal.show { display:flex; }
    .close { position:absolute; top:1rem; right:2rem; font-size:2rem; color:#fff; cursor:pointer; }
    .empty { opacity:0.85; text-align:center; padding:2rem; }

    @media (max-width: 600px) {
      nav { gap: .5rem; padding: .4rem; }
      nav a { font-size:.8rem; }
    }
  </style>
</head>
<body>
  <header>
    <img src="heavy-duty.png" alt="Heavy Duty Productions Logo" id="brandLogo">
    <h1>Heavy Duty Productions</h1>
  </header>

  <nav aria-label="Sections" id="tabs">
    <a class="tab" data-key="" href="#/">HOME</a>
    <a class="tab" data-key="hoodies" href="#/hoodies">HOODIES</a>
    <a class="tab" data-key="tshirts" href="#/tshirts">T-SHIRTS</a>
    <a class="tab" data-key="production-images" href="#/production-images">PRODUCTION IMAGES</a>
  </nav>

  <main>
    <section id="home">
      <h2>Welcome</h2>
      <p>Choose a category above to browse images.</p>
    </section>

    <section id="grid" hidden>
      <div class="grid" id="imageGrid"></div>
      <div class="empty" id="emptyMsg" hidden>No images found.</div>
    </section>
  </main>

  <div class="modal" id="modal">
    <span class="close" id="closeBtn">&times;</span>
    <img id="modalImg" src="" alt="">
  </div>

  <script>
    // CASE-SENSITIVE, RELATIVE paths for GitHub Pages.
    const CATEGORIES = {
      hoodies: "images/Hoodies/",
      tshirts: "images/T-Shirts/",
      "production-images": "images/Production Images/",
    };

    // If you know filenames, list them here to make it bulletproof.
    const MANIFEST = {
      "images/Hoodies/": [],
      "images/T-Shirts/": [],
      "images/Production Images/": [],
    };

    const EXTS = [".jpg",".jpeg",".png",".webp",".gif",".JPG",".JPEG",".PNG",".WEBP",".GIF"];
    const BUILD = Date.now();

    // Common patterns
    const PATTERNS = [
      i => `IMG_${String(i).padStart(4,"0")}`,
      i => `img_${String(i).padStart(4,"0")}`,
      i => `DSC_${String(i).padStart(4,"0")}`,
      i => `image_${String(i).padStart(3,"0")}`,
      i => `photo_${String(i).padStart(3,"0")}`,
      i => String(i).padStart(4,"0"),
      i => String(i).padStart(3,"0"),
      i => String(i).padStart(2,"0"),
      i => String(i),
    ];

    const RANGE_START = 1, RANGE_END = 2000;

    const tabs = document.getElementById("tabs");
    const home = document.getElementById("home");
    const grid = document.getElementById("grid");
    const imageGrid = document.getElementById("imageGrid");
    const emptyMsg = document.getElementById("emptyMsg");
    const modal = document.getElementById("modal");
    const modalImg = document.getElementById("modalImg");
    const closeBtn = document.getElementById("closeBtn");

    closeBtn.onclick = () => modal.classList.remove("show");
    modal.onclick = e => { if (e.target === modal) modal.classList.remove("show"); };
    window.addEventListener("keydown", e => { if (e.key === "Escape") modal.classList.remove("show"); });

    function encPath(path){
      return path.split("/").filter(Boolean).map(encodeURIComponent).join("/") + (path.endsWith("/")?"/":"");
    }

    function setActive(key){
      document.querySelectorAll("nav a.tab").forEach(a => {
        if ((a.dataset.key || "") === (key || "")) a.setAttribute("aria-current","page");
        else a.removeAttribute("aria-current");
      });
    }

    function buildCard(url){
      const card = document.createElement("div");
      card.className = "card";
      const ph = document.createElement("div");
      ph.className = "ph";
      const img = document.createElement("img");
      img.loading = "lazy";
      img.decoding = "async";
      img.style.display = "none";
      img.addEventListener("load", () => { ph.remove(); img.style.display = "block"; });
      img.addEventListener("error", () => { ph.style.animation="none"; ph.style.opacity="0.3"; img.remove(); });
      img.addEventListener("click", () => { modalImg.src = url; modal.classList.add("show"); });
      card._img = img;
      card._src = url;
      card.appendChild(ph);
      card.appendChild(img);
      return card;
    }

    function preload(src){
      return new Promise(res => {
        const i = new Image();
        i.onload = () => res(true);
        i.onerror = () => res(false);
        i.decoding = "async";
        i.src = src;
      });
    }

    async function probeFolder(folderRaw){
      const folder = encPath(folderRaw);
      const found = [];
      for (let n = RANGE_START; n <= RANGE_END; n++){
        // quick bail if we already found many
        if (found.length >= 200) break;
        for (const pat of PATTERNS){
          const base = pat(n);
          let ok = false, name = "";
          for (const ext of EXTS){
            const url = `${folder}${base}${ext}?v=${BUILD}`;
            if (await preload(url)){ ok = true; name = base + ext; break; }
          }
          if (ok){ found.push(name); break; }
        }
      }
      return found;
    }

    async function getFiles(folder){
      // Use inline manifest if provided
      if (Array.isArray(MANIFEST[folder]) && MANIFEST[folder].length) return MANIFEST[folder].slice();
      // Optional: external manifest next to the folder
      try {
        const res = await fetch(`${encPath(folder)}manifest.json?v=${BUILD}`, { cache: "no-store" });
        if (res.ok){
          const arr = await res.json();
          if (Array.isArray(arr) && arr.length) return arr;
        }
      } catch {}
      // Fallback: probe
      return await probeFolder(folder);
    }

    async function loadCategory(key){
      setActive(key);
      if (!key){ home.hidden = false; grid.hidden = true; return; }
      const folder = CATEGORIES[key];
      home.hidden = true; grid.hidden = false;
      imageGrid.innerHTML = "";
      emptyMsg.hidden = true;

      const files = await getFiles(folder);
      if (!files.length){ emptyMsg.hidden = false; return; }

      const folderEnc = encPath(folder);
      const urls = files.map(name => `${folderEnc}${encodeURIComponent(name)}?v=${BUILD}`);
      const cards = urls.map(url => buildCard(url));
      cards.forEach(c => imageGrid.appendChild(c));
      requestAnimationFrame(() => { cards.forEach(c => { const img = c._img; if (img && !img.src) img.src = c._src; }); });
    }

    function route(){
      const hash = location.hash.replace(/^#/, "") || "/";
      if (hash === "/" || hash === "") loadCategory("");
      else if (hash.startsWith("/hoodies")) loadCategory("hoodies");
      else if (hash.startsWith("/tshirts") || hash.startsWith("/t-shirts")) loadCategory("tshirts");
      else if (hash.startsWith("/production-images")) loadCategory("production-images");
      else loadCategory("");
    }

    // Bind once. Prevent multiple router rebinds.
    document.addEventListener("DOMContentLoaded", route, { once:true });
    window.addEventListener("hashchange", route);
  </script>
</body>
</html>
